<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      html,
      body {
        background-color: #f5f5f5;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font:
          14px "Helvetica Neue",
          Helvetica,
          Arial,
          sans-serif;
        box-sizing: border-box;
      }

      * {
        box-sizing: inherit;
        font: inherit;
        text-align: initial;
      }

      p {
        margin: 0;
      }

      #container {
        text-align: center;
      }

      .verticalCenter > * {
        display: inline-block;
        vertical-align: middle;
      }

      .verticalCenter::before {
        content: "";
        display: inline-block;
        height: 100%;
        vertical-align: middle;
      }

      .head {
        font-size: 100px;
        font-weight: 100;
        color: rgba(175, 47, 47, 0.15);
      }

      .head > h2 {
        font-size: inherit;
        font-weight: inherit;
        margin: 0.1em;
        text-align: center;
      }

      .list {
        display: inline-flex;
        text-align: center;
        position: relative;
        flex-direction: column;
      }

      .list > .input {
        width: 550px;
        padding: 16px 16px 16px 60px;
        font-size: 24px;
        border: none;
        outline: none;
        box-shadow: 0px 2px 4px 1px rgba(0, 0, 0, 0.15);
      }

      .input::placeholder {
        color: #ddd;
        font-style: italic;
      }

      .list .allCheck {
        font-size: 22px;
        transform: rotate(90deg);
        padding: 10px 27px;
        position: absolute;
        left: -13px;
        top: 8px;
        cursor: pointer;
        color: #e6e6e6;
        user-select: none;
      }

      .list .allCheck.checked {
        color: #4d4d4d;
      }

      .listItems .msg {
        position: relative;
        height: 48px;
        background-color: #fff;
        z-index: 10;
        box-shadow: 0px 2px 4px 1px rgba(0, 0, 0, 0.15);
        color: rgb(119, 119, 119);
        text-align: center;
        user-select: none;
      }

      .listItems .msg::before {
        content: attr(data-msg) " left";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
      }

      .listItems .msg .toolBtns {
        display: inline-flex;
        height: 100%;
        justify-content: center;
        align-items: center;
      }

      .listItems .msg .toolBtns .btn {
        cursor: pointer;
        padding: 3px 7px;
        border-radius: 3px;
        border: 1px solid transparent;
        margin: 6px;
      }

      .listItems .msg .toolBtns .btn:hover {
        border-color: rgba(175, 47, 47, 0.2);
      }

      .listItems .msg .toolBtns .btn.checked {
        border-color: rgba(175, 47, 47, 0.2);
      }

      .listItems .msg .clear {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
      }

      .listItems .msg .clear:hover {
        text-decoration: underline;
      }

      .listItems .inputItem {
        position: relative;
        font-size: 24px;
        width: 550px;
        background-color: #fff;
        z-index: 10;
        box-shadow: 0px 2px 4px 1px rgba(0, 0, 0, 0.15);
      }

      .listItems::before,
      .listItems::after {
        content: "";
        position: absolute;
        height: 40px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        box-shadow: 0px 2px 4px 1px rgba(0, 0, 0, 0.15);
      }

      .listItems::before {
        z-index: 6;
        width: 98%;
        top: calc(100% - 32px);
      }

      .listItems::after {
        z-index: 3;
        width: 96%;
        top: calc(100% - 24px);
      }

      /* 内容输入框 */

      .inputItem .input {
        height: 60px;
        border: none;
        outline: 1px solid #999;
        padding: 16px 16px 16px 10px;
        margin-left: 50px;
        width: calc(100% - 50px);
        box-shadow: 0 0 3px 1px rgba(100, 100, 100, 0.5) inset;
      }

      /* 输入内容显示 */

      .inputItem .itemContent {
        padding: 16px 16px 16px 60px;
        font-size: 0;
        min-height: 60px;
      }

      .itemContent .content {
        display: inline-block;
        position: relative;
        transition: color 0.5s;
        font-size: 24px;
        line-height: 1.2em;
        word-break: break-all;
        min-width: 100%;
      }

      .itemContent .content:hover .close::after {
        position: absolute;
        content: "×";
        right: 10px;
        color: #cc9a9a;
        font-size: 30px;
        transition: color 0.2s ease-out;
      }

      .itemContent .content:hover .close:hover::after {
        color: #af5b5e;
      }

      .itemContent .check {
        position: absolute;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        border: 1px solid #eee;
        top: 50%;
        left: 6px;
        transform: translateY(-50%);
        z-index: 10;
      }

      .itemContent .check input {
        display: inline-block;
        border: none;
        margin: 0;
        opacity: 0;
        outline: none;
        position: absolute;
        width: 100%;
        height: 100%;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
      }

      .itemContent .check.checked {
        border-color: #ddd;
        text-align: center;
      }

      .itemContent .check.checked + .content {
        text-decoration: line-through;
        color: #ddd;
      }

      .itemContent .check.checked::after {
        font-family: "microsoft yahei";
        content: "√";
        color: turquoise;
        font-size: 24px;
      }

      .hide {
        display: none;
      }

      .border {
        border: 1px solid red;
      }
    </style>
    <script src="../bundle/babel.min.js"></script>
    <!-- <script src="../bundle/react.development.js"></script> -->
    <!-- <script src="../bundle/react-dom.development.js"></script> -->
    <!-- <script id="0_script" type="text/javascript" charset="utf-8" crossorigin="anonymous" src="https://unpkg.com/@my-react/react@latest/dist/umd/index.development.js"></script> -->
    <!-- <script id="2_script" type="text/javascript" charset="utf-8" crossorigin="anonymous" src="https://unpkg.com/@my-react/react-dom@latest/dist/umd/index.development.js"></script> -->
    <script src="../packages/myreact/dist/umd/index.development.js"></script>
    <script src="../packages/myreact-dom/dist/umd/index.development.js"></script>
  </head>

  <body>
    <div id="root"></div>

    <script type="text/babel" async>
      class ToDos extends React.Component {
        constructor(props) {
          super(props);
          this.state = {
            tagShow: "all",
            list: [],
          };
        }

        allCheckTag = () => {
          if (this.state.list.every((it) => it.complated)) {
            this.setState({
              list: this.state.list.map((it) => {
                return {
                  ...it,
                  complated: false,
                };
              }),
            });
          } else {
            this.setState({
              list: this.state.list.map((it) => {
                if (it.complated) {
                  return it;
                } else {
                  return {
                    ...it,
                    complated: true,
                  };
                }
              }),
            });
          }
        };

        currentShowList() {
          if (this.state.tagShow == "all") {
            return this.state.list;
          } else if (this.state.tagShow == "active") {
            return this.state.list.filter((it) => !it.complated);
          } else {
            return this.state.list.filter((it) => it.complated);
          }
        }

        allCheckedWatch() {
          if (this.state.list.length && this.state.list.every((it) => it.complated)) {
            return true;
          } else {
            return false;
          }
        }

        itemCheck(item) {
          this.setState({
            list: [
              ...this.state.list.map((it) => {
                if (it !== item) {
                  return it;
                } else {
                  return {
                    ...item,
                    complated: !item.complated,
                  };
                }
              }),
            ],
          });
        }

        itemEditor(item, flag) {
          console.log("blur", flag, item.editor);
          if (item.editor != flag) {
            this.setState({
              list: [
                ...this.state.list.map((it) => {
                  if (it !== item) {
                    console.log("not equal", it, item);
                    return it;
                  } else {
                    console.log(item, it, this);
                    return {
                      ...item,
                      editor: flag,
                    };
                  }
                }),
              ],
            });
          }
        }

        itemChange(e, item) {
          console.log("change");
          this.setState({
            list: [
              ...this.state.list.map((it) => {
                if (it !== item) {
                  return it;
                } else {
                  return {
                    ...item,
                    content: e.target.value,
                  };
                }
              }),
            ],
          });
        }

        itemSave(e, item, flag) {
          if (e.key == "Enter") {
            this.itemEditor(item, flag);
          }
        }

        itemLast() {
          let last = this.state.list.filter((it) => !it.complated).length;
          if (last < 2) {
            return `${last} item`;
          } else {
            return `${last} items`;
          }
        }

        itemDelete(item) {
          this.setState({
            list: [...this.state.list.filter((it) => it != item)],
          });
        }

        itemDelComplated = () => {
          this.setState({
            allChecked: false,
            list: this.state.list.filter((it) => !it.complated),
          });
        };

        addItem = (e) => {
          if (e.key == "Enter") {
            let value = e.target.value.trim();
            if (value) {
              this.setState({
                list: [
                  ...this.state.list,
                  {
                    content: value,
                    complated: false,
                    editor: false,
                  },
                ],
              });
              e.target.value = "";
            }
          }
        };

        tagShowChange = (e) => {
          let target = e.target;
          let showName = target.name;
          this.setState({
            tagShow: showName,
          });
        };

        componentDidUpdate() {
          console.log("update");
        }

        componentDidMount() {
          console.log("mount");
        }

        render() {
          console.log(this.state.list);
          return (
            <div id="container">
              <div className="head">
                <h2>todos</h2>
              </div>
              <div className="list">
                {this.allCheckedWatch() ? (
                  <span className="allCheck checked" onClick={this.allCheckTag}>
                    ❯
                  </span>
                ) : (
                  <span className="allCheck" onClick={this.allCheckTag}>
                    ❯
                  </span>
                )}
                <input autofocus type="text" className="input" placeholder="What needs to be done?" onKeyUp={this.addItem} />
                {this.state.list.length > 0 && (
                  <div className="listItems">
                    {this.currentShowList().map((it, index) => {
                      return (
                        <div className="inputItem" key={it.content}>
                          {!it.editor ? (
                            <div className="itemContent">
                              <label className={it.complated ? "check checked" : "check"}>
                                <input type="checkbox" onClick={() => this.itemCheck(it)} />
                              </label>
                              <p className="content" onDoubleClick={() => this.itemEditor(it, true)}>
                                {it.content}
                                <i className="close" onClick={() => this.itemDelete(it)}></i>
                              </p>
                            </div>
                          ) : (
                            <input
                              autoFocus
                              type="text"
                              value={it.content}
                              className={it.editor ? "input" : "hide"}
                              onKeyUp={(e) => this.itemSave(e, it, false)}
                              onChange={(e) => this.itemChange(e, it)}
                              onBlur={() => this.itemEditor(it, false)}
                            />
                          )}
                        </div>
                      );
                    })}
                    <div className="msg" data-msg={this.itemLast()}>
                      <span className="toolBtns">
                        <a className={this.state.tagShow == "all" ? "btn checked" : "btn"} name="all" onClick={this.tagShowChange}>
                          All
                        </a>
                        <a className={this.state.tagShow == "active" ? "btn checked" : "btn"} name="active" onClick={this.tagShowChange}>
                          Active
                        </a>
                        <a className={this.state.tagShow == "complated" ? "btn checked" : "btn"} name="complated" onClick={this.tagShowChange}>
                          Completed
                        </a>
                      </span>
                      {this.state.list.some((it) => it.complated) && (
                        <a className="clear" onClick={this.itemDelComplated}>
                          Clear completed
                        </a>
                      )}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        }
      }

      const { useState, useEffect } = React;

      const B = ({ children }) => {
        return <div>{children}</div>;
      };

      const App = () => {
        const [open, setOpen] = useState(true);

        const [list, setList] = useState([]);

        useEffect(() => {
          setList([1, 2, 3, 4, 5, 6, 7, 8]);
        }, []);
        //      {open ? [1].map((i) => <div key={i}>{i}</div>) : []}

        return (
          <div>
            {open ? [1].map((i) => <div key={i}>{i}</div>) : []}
            {list.length ? list.map((i) => <B>{i}</B>) : null}
            <div>
              <button onClick={() => setOpen(!open)}>toggle</button>
            </div>
          </div>
        );
      };

      ReactDOM.render(<ToDos />, document.querySelector("#root"));
    </script>
  </body>
</html>
