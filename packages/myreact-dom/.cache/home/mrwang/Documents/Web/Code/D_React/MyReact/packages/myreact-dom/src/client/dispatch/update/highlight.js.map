{"version":3,"file":"highlight.js","sourceRoot":"","sources":["highlight.ts"],"names":[],"mappings":"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","sourcesContent":["import type { MyReactFiberNode } from \"@my-react/react\";\n\ntype HighlightDOM = HTMLElement & {\n  __pendingHighLight__: boolean;\n};\n\nexport class HighLight {\n  /**\n   * @type HighLight\n   */\n  static instance: HighLight | undefined = undefined;\n\n  /**\n   *\n   * @returns HighLight\n   */\n  static getHighLightInstance = () => {\n    HighLight.instance = HighLight.instance || new HighLight();\n    return HighLight.instance;\n  };\n\n  map: HTMLElement[] = [];\n\n  container: HTMLElement | null = null;\n\n  range = document.createRange();\n\n  __pendingUpdate__: MyReactFiberNode[] = [];\n\n  constructor() {\n    this.container = document.createElement(\"div\");\n    this.container.setAttribute(\"debug_highlight\", \"MyReact\");\n    this.container.style.cssText = `\n      position: absolute;\n      z-index: 999999;\n      width: 100%;\n      left: 0;\n      top: 0;\n      pointer-events: none;\n      `;\n    document.body.append(this.container);\n  }\n\n  createHighLight = () => {\n    const element = document.createElement(\"div\");\n    this.container?.append(element);\n    return element;\n  };\n\n  getHighLight = () => {\n    if (this.map.length > 0) {\n      return this.map.shift() as HTMLElement;\n    }\n    return this.createHighLight();\n  };\n\n  highLight = (fiber: MyReactFiberNode) => {\n    if (fiber.dom) {\n      const typedDom = fiber.dom as HighlightDOM;\n      if (!typedDom.__pendingHighLight__) {\n        typedDom.__pendingHighLight__ = true;\n        this.startHighLight(fiber);\n      }\n    }\n  };\n\n  startHighLight = (fiber: MyReactFiberNode) => {\n    this.__pendingUpdate__.push(fiber);\n    this.flashPending();\n  };\n\n  flashPending = () => {\n    Promise.resolve().then(() => {\n      const allFiber = this.__pendingUpdate__.slice(0);\n      this.__pendingUpdate__ = [];\n      const allWrapper: HTMLElement[] = [];\n      allFiber.forEach((f) => {\n        const wrapperDom = this.getHighLight();\n        allWrapper.push(wrapperDom);\n        f.__isTextNode__ ? this.range.selectNodeContents(f.dom as Text) : this.range.selectNode(f.dom as HTMLElement);\n        const rect = this.range.getBoundingClientRect();\n        const left = rect.left + (document.scrollingElement?.scrollLeft || 0);\n        const top = rect.top + (document.scrollingElement?.scrollTop || 0);\n        const width = rect.width + 4;\n        const height = rect.height + 4;\n        const positionLeft = left - 2;\n        const positionTop = top - 2;\n        wrapperDom.style.cssText = `\n          position: absolute;\n          width: ${width}px;\n          height: ${height}px;\n          left: ${positionLeft}px;\n          top: ${positionTop}px;\n          pointer-events: none;\n          box-shadow: 0.0625rem 0.0625rem 0.0625rem red, -0.0625rem -0.0625rem 0.0625rem red;\n          `;\n      });\n      setTimeout(() => {\n        allWrapper.forEach((wrapperDom) => {\n          wrapperDom.style.boxShadow = \"none\";\n          this.map.push(wrapperDom);\n        });\n        allFiber.forEach((f) => ((f.dom as HighlightDOM).__pendingHighLight__ = false));\n      }, 100);\n    });\n  };\n}\n"]}