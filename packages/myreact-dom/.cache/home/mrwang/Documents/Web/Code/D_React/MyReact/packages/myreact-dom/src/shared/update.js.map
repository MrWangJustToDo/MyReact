{"version":3,"file":"update.js","sourceRoot":"","sources":["update.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,oBAAoB,EAAE,kBAAkB,EAAE,MAAM,iBAAiB,CAAC;AAE3E,OAAO,EAAE,eAAe,EAAE,cAAc,EAAE,uBAAuB,EAAE,MAAM,OAAO,CAAC;AAIzE,IAAA,UAAU,GAAqB,oBAAoB,WAAzC,EAAE,cAAc,GAAK,oBAAoB,eAAzB,CAA0B;AAEpD,IAAA,iBAAiB,GAAK,kBAAkB,kBAAvB,CAAwB;AAEjD,IAAM,WAAW,GAAG;IAClB,IAAI,UAAU,CAAC,OAAO;QAAE,OAAO;IAC/B,IAAI,iBAAiB,CAAC,OAAO,EAAE;QAC7B,cAAc,CAAC,OAAO,CAAC,cAAc,EAAE,CAAC;KACzC;SAAM;QACL,cAAc,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;KACxC;AACH,CAAC,CAAC;AAEF,IAAM,WAAW,GAAG,cAAM,OAAA,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,WAAW,CAAC,EAAnC,CAAmC,CAAC;AAE9D,MAAM,CAAC,IAAM,aAAa,GAAG,UAAC,KAAuB;IACnD,IAAI,cAAc,CAAC,OAAO,IAAI,eAAe,CAAC,OAAO,EAAE;QACrD,IAAI,OAAO,EAAE;YACX,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;SACzC;QACD,OAAO;KACR;IACD,KAAK,CAAC,aAAa,EAAE,CAAC;IACtB,uBAAuB,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC5C,WAAW,EAAE,CAAC;AAChB,CAAC,CAAC","sourcesContent":["import { __myreact_internal__, __myreact_shared__ } from \"@my-react/react\";\n\nimport { isHydrateRender, isServerRender, pendingModifyFiberArray } from \"./env\";\n\nimport type { MyReactFiberNode } from \"@my-react/react\";\n\nconst { globalLoop, globalDispatch } = __myreact_internal__;\n\nconst { enableAsyncUpdate } = __myreact_shared__;\n\nconst updateEntry = () => {\n  if (globalLoop.current) return;\n  if (enableAsyncUpdate.current) {\n    globalDispatch.current.updateAllAsync();\n  } else {\n    globalDispatch.current.updateAllSync();\n  }\n};\n\nconst asyncUpdate = () => Promise.resolve().then(updateEntry);\n\nexport const triggerUpdate = (fiber: MyReactFiberNode) => {\n  if (isServerRender.current || isHydrateRender.current) {\n    if (__DEV__) {\n      console.log(\"can not update component\");\n    }\n    return;\n  }\n  fiber.triggerUpdate();\n  pendingModifyFiberArray.current.push(fiber);\n  asyncUpdate();\n};\n"]}