{"version":3,"file":"updateLoopAsync.js","sourceRoot":"","sources":["updateLoopAsync.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,kBAAkB,EAAE,MAAM,iBAAiB,CAAC;AAErD,OAAO,EAAE,aAAa,EAAE,MAAM,aAAa,CAAC;AAIpC,IAAA,QAAQ,GAAK,kBAAkB,SAAvB,CAAwB;AAExC,MAAM,CAAC,IAAM,eAAe,GAAG,UAC7B,cAOC,EACD,WAA0B,EAC1B,eAA2B;;QAGzB,IAAM,KAAK,GAAG,cAAc,CAAC,OAAO,EAAE,CAAC;QACvC,IAAI,KAAK,EAAE;YACT,IAAM,SAAS,GAAG,QAAQ,CAAC,cAAM,OAAA,aAAa,CAAC,KAAK,EAAE,cAAc,CAAC,WAAW,EAAE,CAAC,EAAlD,CAAkD,CAAC,CAAC;YACrF,cAAc,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YACpC,cAAc,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;SACpC;;IANH,OAAO,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,EAAE;;KAOhD;IACD,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,EAAE;QAC/B,eAAe,EAAE,CAAC;KACnB;AACH,CAAC,CAAC","sourcesContent":["import { __myreact_shared__ } from \"@my-react/react\";\n\nimport { nextWorkAsync } from \"../generate\";\n\nimport type { MyReactFiberNode } from \"@my-react/react\";\n\nconst { safeCall } = __myreact_shared__;\n\nexport const updateLoopAsync = (\n  loopController: {\n    setYield: (f: MyReactFiberNode | null) => void;\n    getNext: () => MyReactFiberNode | null;\n    getUpdateList: (f: MyReactFiberNode) => void;\n    hasNext: () => boolean;\n    doesPause: () => boolean;\n    getTopLevel: () => MyReactFiberNode | null;\n  },\n  shouldPause: () => boolean,\n  reconcileUpdate: () => void\n) => {\n  while (loopController.hasNext() && !shouldPause()) {\n    const fiber = loopController.getNext();\n    if (fiber) {\n      const nextFiber = safeCall(() => nextWorkAsync(fiber, loopController.getTopLevel()));\n      loopController.getUpdateList(fiber);\n      loopController.setYield(nextFiber);\n    }\n  }\n  if (!loopController.doesPause()) {\n    reconcileUpdate();\n  }\n};\n"]}