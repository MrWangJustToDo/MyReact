{"version":3,"file":"instance.js","sourceRoot":"","sources":["instance.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable prefer-rest-params */\nimport { currentFunctionFiber, My_React_Element } from \"../share\";\n\nimport { checkArrayChildrenKey, checkSingleChildrenKey, isValidElement } from \"./tool\";\n\nimport type { MyReactComponent } from \"../component\";\nimport type { MyReactFiberNode } from \"../fiber\";\nimport type { MyReactInternalInstance } from \"../internal\";\nimport type { createRef } from \"../share\";\nimport type { createContext, forwardRef, lazy, memo } from \"./feature\";\n\nexport type FunctionComponent<T extends any[] = any[]> = (...args: T) => ElementNode;\n\nexport type ClassComponent = typeof MyReactComponent;\n\nexport type ObjectComponent =\n  | ReturnType<typeof createContext>[\"Consumer\"]\n  | ReturnType<typeof createContext>[\"Provider\"]\n  | ReturnType<typeof forwardRef>\n  | ReturnType<typeof memo>\n  | ReturnType<typeof lazy>\n  | { [\"$$typeof\"]: symbol; [p: string]: unknown };\n\nexport type MixinClassComponent = ClassComponent & {\n  displayName?: string;\n  defaultProps?: Record<string, unknown>;\n};\n\nexport type MixinFunctionComponent = FunctionComponent & {\n  displayName?: string;\n  defaultProps?: Record<string, unknown>;\n};\n\nexport type ElementType = symbol | string | ObjectComponent | ClassComponent | FunctionComponent;\n\nexport type Element = ReturnType<typeof createVDom>;\n\nexport type ElementNode = Element | string | number | boolean | null | undefined;\n\nexport type MaybeArrayElementNode = ElementNode | ElementNode[];\n\nexport type DynamicElementNode = ElementNode;\n\nexport type ArrayElementNode = ElementNode[];\n\nexport type Props = {\n  children?: MaybeArrayElementNode;\n  [key: string]: unknown;\n};\n\nexport type CreateVDomProps = {\n  type: ElementType;\n  key: string | null;\n  ref: ReturnType<typeof createRef> | ((node?: Node | MyReactInternalInstance) => void) | null;\n  props: Props;\n  _self: MyReactInternalInstance | null;\n  _source: { fileName: string; lineNumber: string } | null;\n  _owner: MyReactFiberNode | null;\n};\n\nexport type CreateElementConfig = {\n  ref?: CreateVDomProps[\"ref\"];\n  key?: CreateVDomProps[\"key\"];\n  __self?: CreateVDomProps[\"_self\"];\n  __source?: CreateVDomProps[\"_source\"];\n  [key: string]: unknown;\n};\n\nexport class MyReactVDom {\n  [\"$$typeof\"] = My_React_Element;\n\n  _store: Record<string, unknown> = {};\n\n  constructor(\n    readonly type: CreateVDomProps[\"type\"],\n    readonly key: CreateVDomProps[\"key\"],\n    readonly ref: CreateVDomProps[\"ref\"],\n    readonly props: CreateVDomProps[\"props\"],\n    readonly _self: CreateVDomProps[\"_self\"],\n    readonly _source: CreateVDomProps[\"_source\"],\n    readonly _owner: CreateVDomProps[\"_owner\"]\n  ) {}\n}\n\nconst createVDom = ({ type, key, ref, props, _self, _source, _owner }: CreateVDomProps) => {\n  return {\n    [\"$$typeof\"]: My_React_Element,\n    type,\n    key,\n    ref,\n    props,\n\n    _owner,\n    _self,\n    _source,\n    _store: {} as Record<string, unknown>,\n  };\n};\n\nexport function createElement(\n  type: CreateVDomProps[\"type\"],\n  config: CreateElementConfig,\n  children?: Props[\"children\"]\n) {\n  let key: CreateVDomProps[\"key\"] = null;\n  let ref: CreateVDomProps[\"ref\"] = null;\n  let self: CreateVDomProps[\"_self\"] = null;\n  let source: CreateVDomProps[\"_source\"] = null;\n\n  const props: CreateVDomProps[\"props\"] = {};\n\n  if (config !== null && config !== undefined) {\n    const { ref: _ref, key: _key, __self, __source, ...resProps } = config;\n    ref = _ref === undefined ? null : _ref;\n    key = _key === undefined ? null : _key + \"\";\n    self = __self === undefined ? null : __self;\n    source = __source === undefined ? null : __source;\n    Object.keys(resProps).forEach((key) => (props[key] = resProps[key]));\n  }\n\n  if (typeof type === \"function\" || typeof type === \"object\") {\n    const typedType = type as MixinClassComponent | MixinFunctionComponent;\n    Object.keys(typedType?.defaultProps || {}).forEach((key) => {\n      props[key] = props[key] === undefined ? typedType.defaultProps?.[key] : props[key];\n    });\n  }\n\n  const childrenLength = arguments.length - 2;\n\n  if (childrenLength > 1) {\n    children = Array.from(arguments).slice(2);\n    checkArrayChildrenKey(children);\n    props.children = children;\n  } else if (childrenLength === 1) {\n    checkSingleChildrenKey(children as ElementNode);\n    props.children = children;\n  }\n\n  return createVDom({\n    type,\n    key,\n    ref,\n    props,\n    _self: self,\n    _source: source,\n    _owner: currentFunctionFiber.current,\n  });\n}\n\nexport function cloneElement(element: ElementNode, config?: CreateElementConfig, children?: Props[\"children\"]) {\n  if (isValidElement(element)) {\n    const props = Object.assign({}, element.props);\n    let key = element.key;\n    let ref = element.ref;\n    const type = element.type;\n    const self = element._self;\n    const source = element._source;\n    let owner = element._owner;\n    if (config !== null && config !== undefined) {\n      const { ref: _ref, key: _key, __self, __source, ...resProps } = config;\n      if (_ref !== undefined) {\n        ref = _ref;\n        owner = currentFunctionFiber.current;\n      }\n      if (_key !== undefined) {\n        key = _key + \"\";\n      }\n      let defaultProps: Record<string, unknown> | undefined = {};\n      if (typeof element.type === \"function\" || typeof element.type === \"object\") {\n        const typedType = element.type as MixinClassComponent | MixinFunctionComponent;\n        defaultProps = typedType?.defaultProps;\n      }\n      for (const key in resProps) {\n        if (Object.prototype.hasOwnProperty.call(resProps, key)) {\n          if (resProps[key] === undefined && defaultProps) {\n            props[key] = defaultProps[key];\n          } else {\n            props[key] = resProps[key];\n          }\n        }\n      }\n    }\n\n    const childrenLength = arguments.length - 2;\n\n    if (childrenLength > 1) {\n      children = Array.from(arguments).slice(2);\n      checkArrayChildrenKey(children);\n      props.children = children;\n    } else if (childrenLength === 1) {\n      checkSingleChildrenKey(children as ElementNode);\n      props.children = children;\n    }\n\n    const clonedElement = createVDom({\n      type,\n      key,\n      ref,\n      props,\n      _self: self,\n      _source: source,\n      _owner: owner,\n    });\n\n    clonedElement._store[\"clonedEle\"] = true;\n\n    return clonedElement;\n  } else {\n    throw new Error(\"cloneElement() need valid element as args\");\n  }\n}\n"]}