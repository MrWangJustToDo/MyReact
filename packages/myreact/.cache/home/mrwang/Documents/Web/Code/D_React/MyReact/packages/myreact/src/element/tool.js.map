{"version":3,"file":"tool.js","sourceRoot":"","sources":["tool.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  log,\n  once,\n  My_React_Consumer,\n  My_React_Element,\n  My_React_ForwardRef,\n  My_React_Fragment,\n  My_React_Lazy,\n  My_React_Memo,\n  My_React_Portal,\n  My_React_Provider,\n  My_React_Strict,\n  My_React_Suspense,\n} from \"../share\";\n\nimport type { NODE_TYPE_KEY } from \"../internal\";\nimport type { MaybeArrayElementNode, Element, DynamicElementNode, ElementNode, ArrayElementNode } from \"./instance\";\n\nexport function isValidElement(element?: MaybeArrayElementNode | null): element is Element {\n  return typeof element === \"object\" && !Array.isArray(element) && element?.$$typeof === My_React_Element;\n}\n\nexport function getTypeFromVDom(element: DynamicElementNode) {\n  const nodeType: { [key in typeof NODE_TYPE_KEY[number]]?: boolean } = {};\n  if (isValidElement(element)) {\n    const rawType = element.type;\n    if (typeof rawType === \"object\") {\n      nodeType.__isObjectNode__ = true;\n      const typedRawType = rawType as { [\"$$typeof\"]: symbol };\n      switch (typedRawType[\"$$typeof\"]) {\n        case My_React_Provider:\n          nodeType.__isContextProvider__ = true;\n          break;\n        case My_React_Consumer:\n          nodeType.__isContextConsumer__ = true;\n          break;\n        case My_React_Portal:\n          nodeType.__isPortal__ = true;\n          break;\n        case My_React_Memo:\n          nodeType.__isMemo__ = true;\n          break;\n        case My_React_ForwardRef:\n          nodeType.__isForwardRef__ = true;\n          break;\n        case My_React_Lazy:\n          nodeType.__isLazy__ = true;\n          break;\n        default:\n          throw new Error(`invalid object element type ${typedRawType[\"$$typeof\"].toString()}`);\n      }\n    } else if (typeof rawType === \"function\") {\n      nodeType.__isDynamicNode__ = true;\n      if (rawType.prototype?.isMyReactComponent) {\n        nodeType.__isClassComponent__ = true;\n      } else {\n        nodeType.__isFunctionComponent__ = true;\n      }\n    } else if (typeof rawType === \"symbol\") {\n      switch (rawType) {\n        case My_React_Fragment:\n          nodeType.__isFragmentNode__ = true;\n          break;\n        case My_React_Strict:\n          nodeType.__isStrictNode__ = true;\n          break;\n        case My_React_Suspense:\n          nodeType.__isSuspense__ = true;\n          break;\n        default:\n          throw new Error(`invalid symbol element type ${rawType.toString()}`);\n      }\n    } else if (typeof rawType === \"string\") {\n      nodeType.__isPlainNode__ = true;\n    } else {\n      throw new Error(`invalid element type ${rawType}`);\n    }\n  } else {\n    if (typeof element === \"object\" && element !== null) {\n      nodeType.__isEmptyNode__ = true;\n    } else if (element === null || element === undefined || element === false) {\n      nodeType.__isNullNode__ = true;\n    } else {\n      nodeType.__isTextNode__ = true;\n    }\n  }\n  return nodeType;\n}\n\nexport const checkValidKey = (children: ArrayElementNode) => {\n  const obj: Record<string, boolean> = {};\n  const onceWarnDuplicate = once(log);\n  const onceWarnUndefined = once(log);\n  children.forEach((c) => {\n    if (isValidElement(c) && !c._store[\"validKey\"]) {\n      if (typeof c.key === \"string\") {\n        if (obj[c.key]) {\n          onceWarnDuplicate({ message: \"array child have duplicate key\" });\n        }\n        obj[c.key] = true;\n      } else {\n        onceWarnUndefined({\n          message: \"each array child must have a unique key props\",\n          triggerOnce: true,\n        });\n      }\n      c._store[\"validKey\"] = true;\n    }\n  });\n};\n\nexport const checkArrayChildrenKey = (children: ArrayElementNode) => {\n  if (__DEV__) {\n    children.forEach((child) => {\n      if (Array.isArray(child)) {\n        checkValidKey(child);\n      } else {\n        if (isValidElement(child)) child._store[\"validKey\"] = true;\n      }\n    });\n  }\n};\n\nexport const checkSingleChildrenKey = (children: ElementNode) => {\n  if (__DEV__) {\n    if (Array.isArray(children)) {\n      checkValidKey(children);\n    } else {\n      if (isValidElement(children)) children._store[\"validKey\"] = true;\n    }\n  }\n};\n"]}