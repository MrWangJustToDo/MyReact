{"version":3,"file":"debug.js","sourceRoot":"","sources":["debug.ts"],"names":[],"mappings":"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","sourcesContent":["import { currentRunningFiber, isAppCrash } from \"./env\";\n\nimport type { MixinClassComponent, MixinFunctionComponent } from \"../element\";\nimport type { MyReactFiberNode } from \"../fiber\";\n\nexport const getTrackDevLog = (fiber: MyReactFiberNode) => {\n  if (!__DEV__) return \"\";\n  const element = fiber.element;\n  const source = typeof element === \"object\" ? element?._source : null;\n  const owner = typeof element === \"object\" ? element?._owner : null;\n  let preString = \"\";\n  if (source) {\n    const { fileName, lineNumber } = source;\n    preString = `${preString} (${fileName}:${lineNumber})`;\n  }\n  if (\n    owner &&\n    !fiber.__isDynamicNode__ &&\n    typeof owner.element === \"object\" &&\n    typeof owner.element?.type === \"function\"\n  ) {\n    const typedType = owner.element.type as MixinClassComponent | MixinFunctionComponent;\n    const name = typedType.displayName || owner.element.type.name;\n    preString = `${preString} (render dy ${name})`;\n  }\n  return preString;\n};\n\nexport const getFiberNodeName = (fiber: MyReactFiberNode) => {\n  if (fiber.__isMemo__) return `<Memo />${getTrackDevLog(fiber)}`;\n  if (fiber.__isLazy__) return `<Lazy />${getTrackDevLog(fiber)}`;\n  if (fiber.__isPortal__) return `<Portal />${getTrackDevLog(fiber)}`;\n  if (fiber.__isNullNode__) return `<null />${getTrackDevLog(fiber)}`;\n  if (fiber.__isEmptyNode__) return `<Empty />${getTrackDevLog(fiber)}`;\n  if (fiber.__isStrictNode__) return `<Strict />${getTrackDevLog(fiber)}`;\n  if (fiber.__isSuspense__) return `<Suspense />${getTrackDevLog(fiber)}`;\n  if (fiber.__isForwardRef__) return `<ForwardRef />${getTrackDevLog(fiber)}`;\n  if (fiber.__isFragmentNode__) return `<Fragment />${getTrackDevLog(fiber)}`;\n  if (fiber.__isContextProvider__) return `<Provider />${getTrackDevLog(fiber)}`;\n  if (fiber.__isContextConsumer__) return `<Consumer />${getTrackDevLog(fiber)}`;\n  if (typeof fiber.element === \"object\" && fiber.element !== null) {\n    if (fiber.__isPlainNode__ && typeof fiber.element?.type === \"string\") {\n      return `<${fiber.element.type} />${getTrackDevLog(fiber)}`;\n    }\n    if (fiber.__isDynamicNode__ && typeof fiber.element?.type === \"function\") {\n      const typedType = fiber.element.type as MixinClassComponent | MixinFunctionComponent;\n      let name = typedType.displayName || fiber.element.type.name || \"anonymous\";\n      name = fiber.__root__ ? `${name} (root)` : name;\n      return `<${name}* />${getTrackDevLog(fiber)}`;\n    }\n    return `<unknown />${getTrackDevLog(fiber)}`;\n  } else {\n    return `<text - (${fiber.element?.toString()}) />${getTrackDevLog(fiber)}`;\n  }\n};\n\nexport const getFiberTree = (fiber?: MyReactFiberNode | null) => {\n  if (fiber) {\n    const preString = \"\".padEnd(4) + \"at\".padEnd(4);\n    let parent = fiber.parent;\n    let res = `${preString}${getFiberNodeName(fiber)}`;\n    while (parent) {\n      res = `${preString}${getFiberNodeName(parent)}\\n${res}`;\n      parent = parent.parent;\n    }\n    return `\\n${res}`;\n  }\n  return \"\";\n};\n\nexport const getHookTree = (hookType: MyReactFiberNode[\"hookType\"], newType: MyReactFiberNode[\"hookType\"]) => {\n  let re = \"\\n\" + \"\".padEnd(6) + \"Prev render:\".padEnd(20) + \"Next render:\".padEnd(10) + \"\\n\";\n  for (const key in hookType) {\n    const c = hookType[key];\n    const n = newType[key];\n    re += (+key + 1).toString().padEnd(6) + c?.padEnd(20) + n?.padEnd(10) + \"\\n\";\n  }\n  re += \"\".padEnd(6) + \"^\".repeat(30) + \"\\n\";\n\n  return re;\n};\n\nconst cache: Record<string, boolean> = {};\n\ntype LogProps = {\n  message: string | Error;\n  fiber?: MyReactFiberNode;\n  triggerOnce?: boolean;\n  level?: \"warn\" | \"error\";\n};\n\nexport const log = ({ fiber, message, level = \"warn\", triggerOnce = false }: LogProps) => {\n  const tree = getFiberTree(fiber || currentRunningFiber.current);\n  if (triggerOnce) {\n    if (cache[tree]) return;\n    cache[tree] = true;\n  }\n  console[level](\n    `[${level}]:`,\n    \"\\n-----------------------------------------\\n\",\n    `${typeof message === \"string\" ? message : message.stack || message.message}`,\n    \"\\n-----------------------------------------\\n\",\n    \"Render Tree:\",\n    tree\n  );\n};\n\nexport const safeCall = <T extends any[] = any[], K = any>(action: (...args: T) => K, ...args: T) => {\n  try {\n    return action.call(null, ...args);\n  } catch (e) {\n    log({ message: e as Error, level: \"error\" });\n    isAppCrash.current = true;\n    throw new Error((e as Error).message);\n  }\n};\n\nexport const safeCallWithFiber = <T extends any[] = any[], K = any>(\n  { action, fiber }: { action: (...args: T) => K; fiber: MyReactFiberNode },\n  ...args: T\n) => {\n  try {\n    return action.call(null, ...args);\n  } catch (e) {\n    log({ message: e as Error, level: \"error\", fiber });\n    isAppCrash.current = true;\n    throw new Error((e as Error).message);\n  }\n};\n"]}